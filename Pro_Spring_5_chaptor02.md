# Chapter 02 - 스프링 시작하기

## 2.1 스프링 프레임워크 가져오기

- 라이브러리를 가져오는 방법
  - 빌드 시스템을 이용
  - 깃허브 저장소에서 소스 코드를 체크아웃 후 사용자가 직접 빌드
  - 메이븐이나 그레이들 같은 빌드 도구의 의존성 관리 기능을 사용하는 것을 추천

### 2.1.1 빠르게 시작하기

- 최신 릴리즈 버전의 스프링은 스프링 프레임워크 프로젝트 페이지 방문 후 가능
- 스프링 부트는 스프링 버전을 지정할 필요가 없음 (starter 프로젝트 객체 모델 파일을 제공)
  - 2.0.0.RELEASE 이전 버전의 스프링 부트는 Spring 4.x 버전을 사용

### 2.1.2 깃허브에서 스프링 체크아웃 하기

- 스냅샷에 반영되기도 전에 사용할 수 있는 방법
- `git clone` 명령어를 통해 사용

### 2.1.3 적절한 JDK 사용하기

- 자바 가상 머신 (Java Virtual Machine, JVM)
  - 구현이 필요한 추상 머신
  - 자바 바이트 코드가 실행될 수 있는 실행 환경을 제공하는 사양
- 자바 실행 환경 (Java Runtime Environment, JRE)
  - JVM의 실체 구현체
  - JVM 구동 시 필요한 라이브러리와 다른 파일 포함
- 자바 개발 도구 (Java Development Kit, JDK)
  - JRE, 매뉴얼 문서 및 자바 도구들을 담고 있음
  - 설치 위치는 별도 지정이 없을 시 PC의 운영체제에 따라 설치
- 메이븐이나 그레이들을 명령창에서 사용하기 위해서는 메이븐/그레이들의 환경 변수를 정의 후 제공하는 실행 파일이 담긴 위치를 시스템 경로에 추가

## 2.2 스프링 모듈 이해하기

- 스프링 모듈
  - 해당 모듈에 필요한 코드를 모아 놓은 JAR 파일

### 2.2.1 스프링 모듈

- aop : AOP 기능을 사용하는데 필요한 모든 클래스 포함
- aspects : AspectJ AOP 라이브러리와 고급 연동에 사용되는 클래스 포함
- beans : 스프링 빈 조작에 필요한 모든 클래스 포함
- beans-groovy : 스프링 빈 조작을 위한 그루비 클래스 포함
- context : 스프링 코어의 기능을 확장한 많은 클래스 포함
  - ApplicationContext에 필요한 클ㄹ래스, EJB, JNDI, JMX, 스프링 리모팅, 동적 스크립트 언어, 빈 유효성 검사, 태스크 스케쥴링 등..
- context-indexer : 색인 작성자 구현 클래스 포함
- context-support : spring-context 모듈의 추가 확장 기능
  - 메일 발송, 벨로시티, 프리마커 등의 템플릿 엔진, CommonJ, 쿼츠 같은 실행 및 스케쥴링 라이브러리
- core : 모든 스프링 기반 애플리케이션에 필요한 핵심 모듈
  - 모든 스프링 모듈의 공통 사용 클래스 포함, 유틸리티 클래스 모음
- expression : 스프링 표현식 언어(SpEL)를 위한 클래스 포함
- instrument : JVM 기동을 위한 인스트루먼테이션 에이전트 포함
- jcl : 로깅 추상화 계층을 제공하는 JCL 관련 인터페이스 포함
- jdbc : JDBC를 지원하는 클래스 포함
  - DB 접속이 필요한 모든 애플리케이션은 이 모듈이 필요
- jms : JMS 사용에 필요한 클래스 포함
- messaging : 메시지 기반 애플리케이션의 기반을 제공하기 위한 핵심 추상화(스프링 인티그레이션 프로젝트) 포함
- orm : 스프링 표준 DJBC 기능을 확장한 ORM 도구를 지원
  - spring-jdbc JAR 파일을 필요로 함
  - 하이버네이트, JDO, JPA, 아이바티스 등..
- oxm : OXM(객체/XML 매핑) 기능을 제공
- test : 테스트를 돕기 위한 목(mock) 클래스를 제공
- tx : 스프링의 트랜잭션 인프라를 담당하는 클래스를 제공
- web : 웹 기반 애플리케이션이 스프링을 사용하는데 필수적인 클래스 포함
- webflux : 스프링 웹 반응형 모델을 지원하기 위한 핵심 인터페이스 & 클래스
- web-mvc : 스프링 자체 MVC 프레임워크와 관련된 모든 클래스들 포함
  - 별도의 MVC 프레임워크 사용 시 이 모듈 필요 X
- websocket : 웹 소켓을 위한 자바 API인 JSR-356 지원

### 2.2.2 애플리케이션에서 사용할 모듈 선택하기

- 의존성 관리 도구 없이 모듈을 직접 선택하는 것은 다소 복잡한 작업
- 메이븐의 전이 의존성 지원과 같은 빌드 도구의 기능을 사용하면 관련 있는 서드파티 라이브러리가 모두 자동으로 포함

### 2.2.3 메이븐 저장소에 있는 모듈 접근하기

- 메이븐은 강력한 빌드, 패키징, 의존성 관리 도구
- 대부분 오픈 소스 프로젝트는 메이븐 저장소를 통해 라이브러리를 배포
  - 메이븐 구성 파일이나 프로젝트 POM 파일에 저장소 정보를 추가하면 사용자를 위해 자체 메이븐 저장소를 제공하는 오픈 소스 커뮤니티도 존재
- 메이븐 아티팩트
  - 그룹 ID, 아티팩트 ID, 패키지 타입, 버전으로 구분
  - ex) log4j 1.2.17버전의 경우 아티팩트 파일 경로는 (그룹 ID)/(아티팩트 ID)/(버전)/log4j-1.2.17.jar
- 메이븐 구성 파일은 XML로 작성, 정의된 메이븐 표준 문법에 따라 작성
- 메이븐 표준 프로젝트 구조도 정의돼 있음
  - main 디렉터리에는 자바 소스 코드와 구성 파일 포함 (java 디렉터리 / resource 디렉터리)
  - test 디렉터리에는 테스트할 때 사용할 java 소스 코드와 구성 파일 포함

### 2.2.4 그레이들을 사용해 스프링 모듈 접근하기

- 그레이들도 아티팩트를 가져오기 위해 메이븐 중앙 저장소를 사용
- 그레이들은 유연한 그루비를 선택
- 그레이들의 구성 파일의 기본 이름은 build.gradle (메이븐의 pom.xml과 같은 역할)
- 메이븐과 마찬가지로 그룹, 아티팩트, 버전으로 아티팩트를 식별하지만 구성 파일에 사용된 프로퍼티 이름은 메이븐 구성과 다름

## 2.3 스프링 문서 사용하기

- 스프링의 문서는 모든 기능을 포괄하며 문서 품질이 뛰어남
  - 스프링의 모든 기능이 자바독으로 완전히 문서화
  - 각 배포판에 포함된 레퍼런스 매뉴얼에도 모든 기능이 담겨 있음

## 2.4 스프링으로 Hello World 애플리케이션 만들기

### 2.4.1 Hello World 애플리케이션 만들기

- "Hellow World!"를 출력하는 애플리케이션 만들기 위한 조건

  - 메시지를 바꿀 수 있는(표준 출력 대신 에러나 단순 텍스트가 아닌 HTML) 유연한 메커니즘을 제공해야 함
  - 출력 결과를 다른 형태로 렌더링 하기 쉬워야 함

- main 함수의 args.length에 따라 조건문으로 상황을 분리 (args가 0인 경우 "Hellow World!" 출력)

  - 코드 변경 없이 메시지를 바꿀 수 있음
  - 하지만 컴포넌트가 출력 메시지 렌더링도 담당하고 있는 문제 (메시지 출력 부분과 메시지를 가져오는 로직을 리펙터링 해야 함)
  - 인터페이스를 이용해 컴포넌트와 론처를 연결하는 유연한 설계도 필요

- MessageProvider 인터페이스 및 그 구현체, MessageRenderer 인터페이스 및 그 구현체로 분리

  - 애플리케이션 로직에서는 인터페이스가 제공하는 메서드만 사용해 상호작용 가능
  - 인터페이스 구현체를 변경하려면 코드를 변경해야 하는 문제가 있음

- 애플리케이션 실행 도중 속성 파일에서 구현 클래스 이름을 읽어 인스턴스로 만드는 간단한 팩터리 클래스 구현 (java.util.Properties 사용)
  - 구성 파일 이름을 하드 코딩

### 2.4.2 스프링으로 리팩터링하기

- 스프링에서 해결할 수 있는 앞선 프로젝트에서 나온 문제들
  - 컴포넌트 접착 코드가 상당히 많음
  - 의존관계가 있는 구현체에 필요한 인스턴스를 직접 제공해야 했음
- 팩토리 클래스를 제거한 뒤 스프링이 제공하는 ApplicationContext 인터페이스로 대체
  - ApplicationContext는 스프링이 관리하는 범위 내에 있는 모든 환경 정보를 저장하는 데 사용
  - ListableBeanFactory라는 인터페이스를 상속해 스프링이 관리하는 모든 빈 인스턴스에 대한 공급자 역할 수행
- XML 파일은 구성 파일과 같은 역할 수행
  - 기본 네임스페이스는 beans (스프링이 관리하는 빈을 정의하는 데 사용)
  - ApplicationContext를 초기화할 때 이 빈 정의로 클래스의 인스턴스를 생성
  - 스프링에게 DI 요구사항을 알려줄 때는 p 네임스페이스 속성 사용
- ApplicationContext 초기화 후 (type-safe) getBean 메서드를 사용해 빈을 가져올 수 있음
  - 스프링 관련 클래스를 사용하기 위한 참조가 필요하지 않으며 스프링의 존재도 모름
- 그레이들을 사용하면 `gradle clean build copyDependencies` 명령어로 프로젝트 및 소스 코드 빌드 가능
  - 그레이들이 모듈에 필요한 모든 전이 의존성 관계에 있는 모듈을 가져옴
  - 프로젝트를 처음부터 빌드 하면서 이전에 생성된 파일을 삭제
  - build/lib으로 모든 의존성을 복사
